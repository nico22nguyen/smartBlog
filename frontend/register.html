<html>
  <head>
      <title>Register</title>
      <script>
        const PORT = 8000

        window.onload = () => {
          document.getElementById('form')
            .addEventListener('submit', register);
        }
        
        const register = (e) => {
          e.preventDefault();
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          const first_name = document.getElementById('first_name').value;
          const last_name = document.getElementById('last_name').value;
          const payload = {
            user: { email, password, first_name, last_name }
          };

          return fetch(`http://localhost:${PORT}/api/user`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          })
            .then(res => {
              if (res.ok) window.location = '/feed'
              else {
                res.text().then(text => {
                  console.error(text)
                  document.getElementById('error-box').innerText = text
                })
              }
            })
            .catch(error => console.error(error));
        };
      </script>
  </head>
  <body>
      <h1>Register</h1>
      <form method="post" id="form">
        <label for="email">Email</label>
        <input type="email" name="email" id="email" />
        <label for="password">Password</label>
        <input type="password" name="password" id="password" />
        <label for="first_name">First Name</label>
        <input type="type" name="first_name" id="first_name" />
        <label for="last_name">Last Name</label>
        <input type="type" name="last_name" id="last_name" />
        <input type="submit" value="Register" />
        <div id="error-box" style="color:red;"></div>
      </form>
</html>